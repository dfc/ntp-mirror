<html lang="en">
<head>
<title>ntpd: Network Time Protocol (NTP) Daemon User's Manual</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="ntpd: Network Time Protocol (NTP) Daemon User's Manual">
<meta name="generator" content="makeinfo 4.7">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc { font-variant:small-caps }
  span.roman { font-family: serif; font-weight: normal; } 
--></style>
</head>
<body>
<h1 class="settitle">ntpd: Network Time Protocol (NTP) Daemon User's Manual</h1>
<div class="node">
<p><hr>
<a name="Top"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-Description">ntpd Description</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>
<br>
</div>

<h2 class="unnumbered">ntpd: Network Time Protocol (NTP) Daemon User Manual</h2>

<p>The <code>ntpd</code> program is an operating system daemon that synchronizes the
system clock to remote NTP time servers or local reference clocks. 
It is a complete implementation of NTP version 4 defined by RFC-5905, but
also retains compatible with version 3 defined by RFC-1305 and versions
1 and 2, defined by RFC-1059 and RFC-1119, respectively. 
The program can operate in any of several modes, including client/server,
symmetric and broadcast modes, and with both symmetric-key and public-key
cryptography.

  <p>This document applies to version 4.2.7p339 of <code>ntpd</code>.

<ul class="menu">
<li><a accesskey="1" href="#ntpd-Description">ntpd Description</a>:             Description
<li><a accesskey="2" href="#ntpd-Invocation">ntpd Invocation</a>: 		Invoking ntpd
<li><a accesskey="3" href="#Usage">Usage</a>:                        Usage
</ul>

<div class="node">
<p><hr>
<a name="ntpd-Description"></a>
<br>
</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">Description</h3>

<p>The <code>ntpd</code> program ordinarily requires
a configuration file described at <a href="#ntp_002econf">ntp.conf</a>. 
This configuration file contains configuration commands described on
the pages listed above. 
However a client can discover remote servers and configure them
automatically. 
This makes it possible to deploy a fleet of workstations without
specifying configuration details specific to the local environment.

  <p>The <code>ntpd</code> program normally operates continuously while adjusting the
system time and frequency, but in some cases this might not be
practical. 
With the <code>-q</code> option <code>ntpd</code> operates as in continuous mode, but
exits just after setting the clock for the first time. 
Most applications will probably want to specify the <code>iburst</code>
option with the <code>server</code> command. 
With this option an initial volley of messages is exchanged to
groom the data and set the clock in about ten seconds' time. 
If nothing is heard after a few minutes' time,
the daemon times out and exits without setting the clock.

<div class="node">
<p><hr>
<a name="ntpd-Invocation"></a>
<br>
</div>

<h3 class="section">Invoking ntpd</h3>

<p><a name="index-ntpd-1"></a><a name="index-NTP-daemon-program-2"></a>

  <p>The
<code>ntpd</code>
utility is an operating system daemon which sets
and maintains the system time of day in synchronism with Internet
standard time servers. 
It is a complete implementation of the
Network Time Protocol (NTP) version 4, as defined by RFC-5905,
but also retains compatibility with
version 3, as defined by RFC-1305, and versions 1
and 2, as defined by RFC-1059 and RFC-1119, respectively.

  <p>The
<code>ntpd</code>
utility does most computations in 64-bit floating point
arithmetic and does relatively clumsy 64-bit fixed point operations
only when necessary to preserve the ultimate precision, about 232
picoseconds. 
While the ultimate precision is not achievable with
ordinary workstations and networks of today, it may be required
with future gigahertz CPU clocks and gigabit LANs.

  <p>Ordinarily,
<code>ntpd</code>
reads the
<code>ntp.conf(5)</code>
configuration file at startup time in order to determine the
synchronization sources and operating modes. 
It is also possible to
specify a working, although limited, configuration entirely on the
command line, obviating the need for a configuration file. 
This may
be particularly useful when the local host is to be configured as a
broadcast/multicast client, with all peers being determined by
listening to broadcasts at run time.

  <p>If NetInfo support is built into
<code>ntpd</code>,
then
<code>ntpd</code>
will attempt to read its configuration from the
NetInfo if the default
<code>ntp.conf(5)</code>
file cannot be read and no file is
specified by the
<code>-c</code> option.

  <p>Various internal
<code>ntpd</code>
variables can be displayed and
configuration options altered while the
<code>ntpd</code>
is running
using the
<code>ntpq(8)</code>
and
<code>ntpdc(8)</code>
utility programs.

  <p>When
<code>ntpd</code>
starts it looks at the value of
<code>umask(2)</code>,
and if zero
<code>ntpd</code>
will set the
<code>umask(2)</code>
to 022.

  <p>This section was generated by <strong>AutoGen</strong>,
using the <code>agtexi-cmd</code> template and the option descriptions for the <code>ntpd</code> program. 
This software is released under the NTP license, &lt;http://ntp.org/license&gt;.

<ul class="menu">
<li><a accesskey="1" href="#ntpd-usage">ntpd usage</a>:                   ntpd help/usage (<span class="option">--help</span>)
<li><a accesskey="2" href="#ntpd-ipv4">ntpd ipv4</a>:                    ipv4 option (-4)
<li><a accesskey="3" href="#ntpd-ipv6">ntpd ipv6</a>:                    ipv6 option (-6)
<li><a accesskey="4" href="#ntpd-authreq">ntpd authreq</a>:                 authreq option (-a)
<li><a accesskey="5" href="#ntpd-authnoreq">ntpd authnoreq</a>:               authnoreq option (-A)
<li><a accesskey="6" href="#ntpd-configfile">ntpd configfile</a>:              configfile option (-c)
<li><a accesskey="7" href="#ntpd-driftfile">ntpd driftfile</a>:               driftfile option (-f)
<li><a accesskey="8" href="#ntpd-panicgate">ntpd panicgate</a>:               panicgate option (-g)
<li><a accesskey="9" href="#ntpd-jaildir">ntpd jaildir</a>:                 jaildir option (-i)
<li><a href="#ntpd-interface">ntpd interface</a>:               interface option (-I)
<li><a href="#ntpd-keyfile">ntpd keyfile</a>:                 keyfile option (-k)
<li><a href="#ntpd-logfile">ntpd logfile</a>:                 logfile option (-l)
<li><a href="#ntpd-novirtualips">ntpd novirtualips</a>:            novirtualips option (-L)
<li><a href="#ntpd-modifymmtimer">ntpd modifymmtimer</a>:           modifymmtimer option (-M)
<li><a href="#ntpd-nice">ntpd nice</a>:                    nice option (-N)
<li><a href="#ntpd-pidfile">ntpd pidfile</a>:                 pidfile option (-p)
<li><a href="#ntpd-priority">ntpd priority</a>:                priority option (-P)
<li><a href="#ntpd-quit">ntpd quit</a>:                    quit option (-q)
<li><a href="#ntpd-propagationdelay">ntpd propagationdelay</a>:        propagationdelay option (-r)
<li><a href="#ntpd-saveconfigquit">ntpd saveconfigquit</a>:          saveconfigquit option
<li><a href="#ntpd-statsdir">ntpd statsdir</a>:                statsdir option (-s)
<li><a href="#ntpd-trustedkey">ntpd trustedkey</a>:              trustedkey option (-t)
<li><a href="#ntpd-user">ntpd user</a>:                    user option (-u)
<li><a href="#ntpd-updateinterval">ntpd updateinterval</a>:          updateinterval option (-U)
<li><a href="#ntpd-wait_002dsync">ntpd wait-sync</a>:               wait-sync option (-w)
<li><a href="#ntpd-slew">ntpd slew</a>:                    slew option (-x)
<li><a href="#ntpd-usepcc">ntpd usepcc</a>:                  usepcc option
<li><a href="#ntpd-pccfreq">ntpd pccfreq</a>:                 pccfreq option
<li><a href="#ntpd-mdns">ntpd mdns</a>:                    mdns option (-m)
<li><a href="#ntpd-config">ntpd config</a>:                  presetting/configuring ntpd
<li><a href="#ntpd-exit-status">ntpd exit status</a>:             exit status
<li><a href="#ntpd-Usage">ntpd Usage</a>:                   Usage
<li><a href="#ntpd-Files">ntpd Files</a>:                   Files
<li><a href="#ntpd-See-Also">ntpd See Also</a>:                See Also
<li><a href="#ntpd-Bugs">ntpd Bugs</a>:                    Bugs
<li><a href="#ntpd-Notes">ntpd Notes</a>:                   Notes
</ul>

<div class="node">
<p><hr>
<a name="ntpd-usage"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-ipv4">ntpd ipv4</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ntpd help/usage (<span class="option">--help</span>)</h4>

<p><a name="index-ntpd-help-3"></a>
This is the automatically generated usage text for ntpd.

  <p>The text printed is the same whether selected with the <code>help</code> option
(<span class="option">--help</span>) or the <code>more-help</code> option (<span class="option">--more-help</span>).  <code>more-help</code> will print
the usage text by passing it through a pager program. 
<code>more-help</code> is disabled on platforms without a working
<code>fork(2)</code> function.  The <code>PAGER</code> environment variable is
used to select the program, defaulting to <span class="file">more</span>.  Both will exit
with a status code of 0.

<pre class="example">ntpd - NTP daemon program - Ver. 4.2.7p338
USAGE:  ntpd [ -&lt;flag&gt; [&lt;val&gt;] | --&lt;name&gt;[{=| }&lt;val&gt;] ]... \
                [ &lt;server1&gt; ... &lt;serverN&gt; ]
  Flg Arg Option-Name    Description
   -4 no  ipv4           Force IPv4 DNS name resolution
                                - prohibits these options:
                                ipv6
   -6 no  ipv6           Force IPv6 DNS name resolution
                                - prohibits these options:
                                ipv4
   -a no  authreq        Require crypto authentication
                                - prohibits these options:
                                authnoreq
   -A no  authnoreq      Do not require crypto authentication
                                - prohibits these options:
                                authreq
   -b no  bcastsync      Allow us to sync to broadcast servers
   -c Str configfile     configuration file name
   -d no  debug-level    Increase debug verbosity level
                                - may appear multiple times
   -D Num set-debug-level Set the debug verbosity level
                                - may appear multiple times
   -f Str driftfile      frequency drift file name
   -g no  panicgate      Allow the first adjustment to be Big
                                - may appear multiple times
   -i --- jaildir        built without --enable-clockctl or --enable-linuxcaps
   -I Str interface      Listen on an interface name or address
                                - may appear multiple times
   -k Str keyfile        path to symmetric keys
   -l Str logfile        path to the log file
   -L no  novirtualips   Do not listen to virtual interfaces
   -n no  nofork         Do not fork
                                - prohibits these options:
                                wait-sync
   -N no  nice           Run at high priority
   -p Str pidfile        path to the PID file
   -P Num priority       Process priority
   -q no  quit           Set the time and quit
                                - prohibits these options:
                                saveconfigquit
                                wait-sync
   -r Str propagationdelay Broadcast/propagation delay
      Str saveconfigquit Save parsed configuration and quit
                                - prohibits these options:
                                quit
                                wait-sync
   -s Str statsdir       Statistics file location
   -t Str trustedkey     Trusted key number
                                - may appear multiple times
   -u --- user           built without --enable-clockctl or --enable-linuxcaps
   -U Num updateinterval interval in seconds between scans for new or dropped interfaces
      Str var            make ARG an ntp variable (RW)
                                - may appear multiple times
      Str dvar           make ARG an ntp variable (RW|DEF)
                                - may appear multiple times
   -w Num wait-sync      Seconds to wait for first clock sync
                                - prohibits these options:
                                nofork
                                quit
                                saveconfigquit
   -x no  slew           Slew up to 600 seconds
   -" opt version        Output version information and exit
   -? no  help           Display extended usage information and exit
   -! no  more-help      Extended usage information passed thru pager

Options are specified by doubled hyphens and their name or by a single
hyphen and the flag character.



The following option preset mechanisms are supported:
 - examining environment variables named NTPD_*

please send bug reports to:  http://bugs.ntp.org, bugs@ntp.org
</pre>
  <div class="node">
<p><hr>
<a name="ntpd-ipv4"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-ipv6">ntpd ipv6</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-usage">ntpd usage</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ipv4 option (-4)</h4>

<p><a name="index-ntpd_002dipv4-4"></a>
This is the &ldquo;force ipv4 dns name resolution&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must not appear in combination with any of the following options:
ipv6. 
</ul>

  <p>Force DNS resolution of following host names on the command line
to the IPv4 namespace. 
<div class="node">
<p><hr>
<a name="ntpd-ipv6"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-authreq">ntpd authreq</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-ipv4">ntpd ipv4</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ipv6 option (-6)</h4>

<p><a name="index-ntpd_002dipv6-5"></a>
This is the &ldquo;force ipv6 dns name resolution&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must not appear in combination with any of the following options:
ipv4. 
</ul>

  <p>Force DNS resolution of following host names on the command line
to the IPv6 namespace. 
<div class="node">
<p><hr>
<a name="ntpd-authreq"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-authnoreq">ntpd authnoreq</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-ipv6">ntpd ipv6</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">authreq option (-a)</h4>

<p><a name="index-ntpd_002dauthreq-6"></a>
This is the &ldquo;require crypto authentication&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must not appear in combination with any of the following options:
authnoreq. 
</ul>

  <p>Require cryptographic authentication for broadcast client,
multicast client and symmetric passive associations. 
This is the default. 
<div class="node">
<p><hr>
<a name="ntpd-authnoreq"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-configfile">ntpd configfile</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-authreq">ntpd authreq</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">authnoreq option (-A)</h4>

<p><a name="index-ntpd_002dauthnoreq-7"></a>
This is the &ldquo;do not require crypto authentication&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must not appear in combination with any of the following options:
authreq. 
</ul>

  <p>Do not require cryptographic authentication for broadcast client,
multicast client and symmetric passive associations. 
This is almost never a good idea. 
<div class="node">
<p><hr>
<a name="ntpd-configfile"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-driftfile">ntpd driftfile</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-authnoreq">ntpd authnoreq</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">configfile option (-c)</h4>

<p><a name="index-ntpd_002dconfigfile-8"></a>
This is the &ldquo;configuration file name&rdquo; option. 
This option takes an argument string. 
The name and path of the configuration file,
<span class="file">/etc/ntp.conf</span>
by default. 
<div class="node">
<p><hr>
<a name="ntpd-driftfile"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-panicgate">ntpd panicgate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-configfile">ntpd configfile</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">driftfile option (-f)</h4>

<p><a name="index-ntpd_002ddriftfile-9"></a>
This is the &ldquo;frequency drift file name&rdquo; option. 
This option takes an argument string. 
The name and path of the frequency file,
<span class="file">/etc/ntp.drift</span>
by default. 
This is the same operation as the
<code>driftfile</code> <kbd>driftfile</kbd>
configuration specification in the
<span class="file">/etc/ntp.conf</span>
file. 
<div class="node">
<p><hr>
<a name="ntpd-panicgate"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-jaildir">ntpd jaildir</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-driftfile">ntpd driftfile</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">panicgate option (-g)</h4>

<p><a name="index-ntpd_002dpanicgate-10"></a>
This is the &ldquo;allow the first adjustment to be big&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>may appear an unlimited number of times. 
</ul>

  <p>Normally,
<code>ntpd</code>
exits with a message to the system log if the offset exceeds the panic threshold, which is 1000 s by default. This option allows the time to be set to any value without restriction; however, this can happen only once. If the threshold is exceeded after that,
<code>ntpd</code>
will exit with a message to the system log. This option can be used with the
<code>-q</code>
and
<code>-x</code>
options. 
See the
<code>tinker</code>
configuration file directive for other options. 
<div class="node">
<p><hr>
<a name="ntpd-jaildir"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-interface">ntpd interface</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-panicgate">ntpd panicgate</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">jaildir option (-i)</h4>

<p><a name="index-ntpd_002djaildir-11"></a>
This is the &ldquo;jail directory&rdquo; option. 
This option takes an argument string.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>HAVE_DROPROOT</code> during the compilation. 
</ul>

  <p>Chroot the server to the directory
<kbd>jaildir</kbd>
. 
This option also implies that the server attempts to drop root privileges at startup. 
You may need to also specify a
<code>-u</code>
option. 
This option is only available if the OS supports adjusting the clock
without full root privileges. 
This option is supported under NetBSD (configure with
<code>--enable-clockctl</code>) and Linux (configure with
<code>--enable-linuxcaps</code>). 
<div class="node">
<p><hr>
<a name="ntpd-interface"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-keyfile">ntpd keyfile</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-jaildir">ntpd jaildir</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">interface option (-I)</h4>

<p><a name="index-ntpd_002dinterface-12"></a>
This is the &ldquo;listen on an interface name or address&rdquo; option. 
This option takes an argument string <span class="file">iface</span>.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>may appear an unlimited number of times. 
</ul>

  <p>Open the network address given, or all the addresses associated with the
given interface name.  This option may appear multiple times.  This option
also implies not opening other addresses, except wildcard and localhost. 
This option is deprecated. Please consider using the configuration file
<code>interface</code> command, which is more versatile. 
<div class="node">
<p><hr>
<a name="ntpd-keyfile"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-logfile">ntpd logfile</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-interface">ntpd interface</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">keyfile option (-k)</h4>

<p><a name="index-ntpd_002dkeyfile-13"></a>
This is the &ldquo;path to symmetric keys&rdquo; option. 
This option takes an argument string. 
Specify the name and path of the symmetric key file. 
<span class="file">/etc/ntp.keys</span>
is the default. 
This is the same operation as the
<code>keys</code> <kbd>keyfile</kbd>
configuration file directive. 
<div class="node">
<p><hr>
<a name="ntpd-logfile"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-novirtualips">ntpd novirtualips</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-keyfile">ntpd keyfile</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">logfile option (-l)</h4>

<p><a name="index-ntpd_002dlogfile-14"></a>
This is the &ldquo;path to the log file&rdquo; option. 
This option takes an argument string. 
Specify the name and path of the log file. 
The default is the system log file. 
This is the same operation as the
<code>logfile</code> <kbd>logfile</kbd>
configuration file directive. 
<div class="node">
<p><hr>
<a name="ntpd-novirtualips"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-modifymmtimer">ntpd modifymmtimer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-logfile">ntpd logfile</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">novirtualips option (-L)</h4>

<p><a name="index-ntpd_002dnovirtualips-15"></a>
This is the &ldquo;do not listen to virtual interfaces&rdquo; option. 
Do not listen to virtual interfaces, defined as those with
names containing a colon.  This option is deprecated.  Please
consider using the configuration file <code>interface</code> command, which
is more versatile. 
<div class="node">
<p><hr>
<a name="ntpd-modifymmtimer"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-nice">ntpd nice</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-novirtualips">ntpd novirtualips</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">modifymmtimer option (-M)</h4>

<p><a name="index-ntpd_002dmodifymmtimer-16"></a>
This is the &ldquo;modify multimedia timer (windows only)&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>SYS_WINNT</code> during the compilation. 
</ul>

  <p>Set the Windows Multimedia Timer to highest resolution.  This
ensures the resolution does not change while ntpd is running,
avoiding timekeeping glitches associated with changes. 
<div class="node">
<p><hr>
<a name="ntpd-nice"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-pidfile">ntpd pidfile</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-modifymmtimer">ntpd modifymmtimer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">nice option (-N)</h4>

<p><a name="index-ntpd_002dnice-17"></a>
This is the &ldquo;run at high priority&rdquo; option. 
To the extent permitted by the operating system, run
<code>ntpd</code>
at the highest priority. 
<div class="node">
<p><hr>
<a name="ntpd-pidfile"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-priority">ntpd priority</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-nice">ntpd nice</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">pidfile option (-p)</h4>

<p><a name="index-ntpd_002dpidfile-18"></a>
This is the &ldquo;path to the pid file&rdquo; option. 
This option takes an argument string. 
Specify the name and path of the file used to record
<code>ntpd</code>'s
process ID. 
This is the same operation as the
<code>pidfile</code> <kbd>pidfile</kbd>
configuration file directive. 
<div class="node">
<p><hr>
<a name="ntpd-priority"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-quit">ntpd quit</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-pidfile">ntpd pidfile</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">priority option (-P)</h4>

<p><a name="index-ntpd_002dpriority-19"></a>
This is the &ldquo;process priority&rdquo; option. 
This option takes an argument number. 
To the extent permitted by the operating system, run
<code>ntpd</code>
at the specified
<code>sched_setscheduler(SCHED_FIFO)</code>
priority. 
<div class="node">
<p><hr>
<a name="ntpd-quit"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-propagationdelay">ntpd propagationdelay</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-priority">ntpd priority</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">quit option (-q)</h4>

<p><a name="index-ntpd_002dquit-20"></a>
This is the &ldquo;set the time and quit&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must not appear in combination with any of the following options:
saveconfigquit, wait-sync. 
</ul>

  <p><code>ntpd</code>
will not daemonize and will exit after the clock is first
synchronized.  This behavior mimics that of the
<code>ntpdate</code>
program, which will soon be replaced with a shell script. 
The
<code>-g</code>
and
<code>-x</code>
options can be used with this option. 
Note: The kernel time discipline is disabled with this option. 
<div class="node">
<p><hr>
<a name="ntpd-propagationdelay"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-saveconfigquit">ntpd saveconfigquit</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-quit">ntpd quit</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">propagationdelay option (-r)</h4>

<p><a name="index-ntpd_002dpropagationdelay-21"></a>
This is the &ldquo;broadcast/propagation delay&rdquo; option. 
This option takes an argument string. 
Specify the default propagation delay from the broadcast/multicast server to this client. This is necessary only if the delay cannot be computed automatically by the protocol. 
<div class="node">
<p><hr>
<a name="ntpd-saveconfigquit"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-statsdir">ntpd statsdir</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-propagationdelay">ntpd propagationdelay</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">saveconfigquit option</h4>

<p><a name="index-ntpd_002dsaveconfigquit-22"></a>
This is the &ldquo;save parsed configuration and quit&rdquo; option. 
This option takes an argument string.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>SAVECONFIG</code> during the compilation. 
<li>must not appear in combination with any of the following options:
quit, wait-sync. 
</ul>

  <p>Cause <code>ntpd</code> to parse its startup configuration file and save an
equivalent to the given filename and exit.  This option was
designed for automated testing. 
<div class="node">
<p><hr>
<a name="ntpd-statsdir"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-trustedkey">ntpd trustedkey</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-saveconfigquit">ntpd saveconfigquit</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">statsdir option (-s)</h4>

<p><a name="index-ntpd_002dstatsdir-23"></a>
This is the &ldquo;statistics file location&rdquo; option. 
This option takes an argument string. 
Specify the directory path for files created by the statistics facility. 
This is the same operation as the
<code>statsdir</code> <kbd>statsdir</kbd>
configuration file directive. 
<div class="node">
<p><hr>
<a name="ntpd-trustedkey"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-user">ntpd user</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-statsdir">ntpd statsdir</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">trustedkey option (-t)</h4>

<p><a name="index-ntpd_002dtrustedkey-24"></a>
This is the &ldquo;trusted key number&rdquo; option. 
This option takes an argument string <span class="file">tkey</span>.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>may appear an unlimited number of times. 
</ul>

  <p>Add the specified key number to the trusted key list. 
<div class="node">
<p><hr>
<a name="ntpd-user"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-updateinterval">ntpd updateinterval</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-trustedkey">ntpd trustedkey</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">user option (-u)</h4>

<p><a name="index-ntpd_002duser-25"></a>
This is the &ldquo;run as userid (or userid:groupid)&rdquo; option. 
This option takes an argument string.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>HAVE_DROPROOT</code> during the compilation. 
</ul>

  <p>Specify a user, and optionally a group, to switch to. 
This option is only available if the OS supports adjusting the clock
without full root privileges. 
This option is supported under NetBSD (configure with
<code>--enable-clockctl</code>) and Linux (configure with
<code>--enable-linuxcaps</code>). 
<div class="node">
<p><hr>
<a name="ntpd-updateinterval"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-wait_002dsync">ntpd wait-sync</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-user">ntpd user</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">updateinterval option (-U)</h4>

<p><a name="index-ntpd_002dupdateinterval-26"></a>
This is the &ldquo;interval in seconds between scans for new or dropped interfaces&rdquo; option. 
This option takes an argument number. 
Give the time in seconds between two scans for new or dropped interfaces. 
For systems with routing socket support the scans will be performed shortly after the interface change
has been detected by the system. 
Use 0 to disable scanning. 60 seconds is the minimum time between scans. 
<div class="node">
<p><hr>
<a name="ntpd-wait_002dsync"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-slew">ntpd slew</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-updateinterval">ntpd updateinterval</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">wait-sync option (-w)</h4>

<p><a name="index-ntpd_002dwait_002dsync-27"></a>
This is the &ldquo;seconds to wait for first clock sync&rdquo; option. 
This option takes an argument number.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>HAVE_WORKING_FORK</code> during the compilation. 
<li>must not appear in combination with any of the following options:
nofork, quit, saveconfigquit. 
</ul>

  <p>If greater than zero, alters <code>ntpd</code>'s behavior when forking to
daemonize.  Instead of exiting with status 0 immediately after
the fork, the parent waits up to the specified number of
seconds for the child to first synchronize the clock.  The exit
status is zero (success) if the clock was synchronized,
otherwise it is <code>ETIMEDOUT</code>. 
This provides the option for a script starting <code>ntpd</code> to easily
wait for the first set of the clock before proceeding. 
<div class="node">
<p><hr>
<a name="ntpd-slew"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-usepcc">ntpd usepcc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-wait_002dsync">ntpd wait-sync</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">slew option (-x)</h4>

<p><a name="index-ntpd_002dslew-28"></a>
This is the &ldquo;slew up to 600 seconds&rdquo; option. 
Normally, the time is slewed if the offset is less than the step threshold, which is 128 ms by default, and stepped if above the threshold. 
This option sets the threshold to 600 s, which is well within the accuracy window to set the clock manually. 
Note: Since the slew rate of typical Unix kernels is limited to 0.5 ms/s, each second of adjustment requires an amortization interval of 2000 s. 
Thus, an adjustment as much as 600 s will take almost 14 days to complete. 
This option can be used with the
<code>-g</code>
and
<code>-q</code>
options. 
See the
<code>tinker</code>
configuration file directive for other options. 
Note: The kernel time discipline is disabled with this option. 
<div class="node">
<p><hr>
<a name="ntpd-usepcc"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-pccfreq">ntpd pccfreq</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-slew">ntpd slew</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">usepcc option</h4>

<p><a name="index-ntpd_002dusepcc-29"></a>
This is the &ldquo;use cpu cycle counter (windows only)&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>SYS_WINNT</code> during the compilation. 
</ul>

  <p>Attempt to substitute the CPU counter for <code>QueryPerformanceCounter</code>. 
The CPU counter and <code>QueryPerformanceCounter</code> are compared, and if
they have the same frequency, the CPU counter (RDTSC on x86) is
used directly, saving the overhead of a system call. 
<div class="node">
<p><hr>
<a name="ntpd-pccfreq"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-mdns">ntpd mdns</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-usepcc">ntpd usepcc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">pccfreq option</h4>

<p><a name="index-ntpd_002dpccfreq-30"></a>
This is the &ldquo;force cpu cycle counter use (windows only)&rdquo; option. 
This option takes an argument string.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>SYS_WINNT</code> during the compilation. 
</ul>

  <p>Force substitution the CPU counter for <code>QueryPerformanceCounter</code>. 
The CPU counter (RDTSC on x86) is used unconditionally with the
given frequency (in Hz). 
<div class="node">
<p><hr>
<a name="ntpd-mdns"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-config">ntpd config</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-pccfreq">ntpd pccfreq</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">mdns option (-m)</h4>

<p><a name="index-ntpd_002dmdns-31"></a>
This is the &ldquo;register with mdns as a ntp server&rdquo; option.

<p class="noindent">This option has some usage constraints.  It:
     <ul>
<li>must be compiled in by defining <code>HAVE_DNSREGISTRATION</code> during the compilation. 
</ul>

  <p>Registers as an NTP server with the local mDNS server which allows
the server to be discovered via mDNS client lookup.

<div class="node">
<p><hr>
<a name="ntpd-config"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-exit-status">ntpd exit status</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-mdns">ntpd mdns</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">presetting/configuring ntpd</h4>

<p>Any option that is not marked as <i>not presettable</i> may be preset by
loading values from environment variables named <code>NTPD</code> and <code>NTPD_&lt;OPTION_NAME&gt;</code>.  <code>&lt;OPTION_NAME&gt;</code> must be one of
the options listed above in upper case and segmented with underscores. 
The <code>NTPD</code> variable will be tokenized and parsed like
the command line.  The remaining variables are tested for existence and their
values are treated like option arguments.

  <p>The command line options relating to configuration and/or usage help are:

<h5 class="subsubheading">version (-)</h5>

<p>Print the program version to standard out, optionally with licensing
information, then exit 0.  The optional argument specifies how much licensing
detail to provide.  The default is to print just the version.  The licensing infomation may be selected with an option argument.  Only the
first letter of the argument is examined:

     <dl>
<dt><span class="samp">version</span><dd>Only print the version.  This is the default. 
<br><dt><span class="samp">copyright</span><dd>Name the copyright usage licensing terms. 
<br><dt><span class="samp">verbose</span><dd>Print the full copyright usage licensing terms. 
</dl>

<div class="node">
<p><hr>
<a name="ntpd-exit-status"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-Usage">ntpd Usage</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-config">ntpd config</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ntpd exit status</h4>

<p>One of the following exit values will be returned:
     <dl>
<dt><span class="samp">0 (EXIT_SUCCESS)</span><dd>Successful program execution. 
<br><dt><span class="samp">1 (EXIT_FAILURE)</span><dd>The operation failed or the command syntax was not valid. 
</dl>
  <div class="node">
<p><hr>
<a name="ntpd-Usage"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-Files">ntpd Files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-exit-status">ntpd exit status</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ntpd Usage</h4>

<div class="node">
<p><hr>
<a name="How-NTP-Operates"></a>
<br>
</div>

<h3 class="section">How NTP Operates</h3>

<p>How NTP Operates
The
<code>ntpd</code>
utility operates by exchanging messages with
one or more configured servers over a range of designated poll intervals. 
When
started, whether for the first or subsequent times, the program
requires several exchanges from the majority of these servers so
the signal processing and mitigation algorithms can accumulate and
groom the data and set the clock. 
In order to protect the network
from bursts, the initial poll interval for each server is delayed
an interval randomized over a few seconds. 
At the default initial poll
interval of 64s, several minutes can elapse before the clock is
set. 
This initial delay to set the clock
can be safely and dramatically reduced using the
<code>iburst</code> keyword with the
<code>server</code> configuration
command, as described in
<code>ntp.conf(5)</code>.

  <p>Most operating systems and hardware of today incorporate a
time-of-year (TOY) chip to maintain the time during periods when
the power is off. 
When the machine is booted, the chip is used to
initialize the operating system time. 
After the machine has
synchronized to a NTP server, the operating system corrects the
chip from time to time. 
In the default case, if
<code>ntpd</code>
detects that the time on the host
is more than 1000s from the server time,
<code>ntpd</code>
assumes something must be terribly wrong and the only
reliable action is for the operator to intervene and set the clock
by hand. 
(Reasons for this include there is no TOY chip,
or its battery is dead, or that the TOY chip is just of poor quality.) 
This causes
<code>ntpd</code>
to exit with a panic message to
the system log. 
The
<code>-g</code> option overrides this check and the
clock will be set to the server time regardless of the chip time
(up to 68 years in the past or future \(em
this is a limitation of the NTPv4 protocol). 
However, and to protect against broken hardware, such as when the
CMOS battery fails or the clock counter becomes defective, once the
clock has been set an error greater than 1000s will cause
<code>ntpd</code>
to exit anyway.

  <p>Under ordinary conditions,
<code>ntpd</code>
adjusts the clock in
small steps so that the timescale is effectively continuous and
without discontinuities. 
Under conditions of extreme network
congestion, the roundtrip delay jitter can exceed three seconds and
the synchronization distance, which is equal to one-half the
roundtrip delay plus error budget terms, can become very large. 
The
<code>ntpd</code>
algorithms discard sample offsets exceeding 128 ms,
unless the interval during which no sample offset is less than 128
ms exceeds 900s. 
The first sample after that, no matter what the
offset, steps the clock to the indicated time. 
In practice this
reduces the false alarm rate where the clock is stepped in error to
a vanishingly low incidence.

  <p>As the result of this behavior, once the clock has been set it
very rarely strays more than 128 ms even under extreme cases of
network path congestion and jitter. 
Sometimes, in particular when
<code>ntpd</code>
is first started without a valid drift file
on a system with a large intrinsic drift
the error might grow to exceed 128 ms,
which would cause the clock to be set backwards
if the local clock time is more than 128 s
in the future relative to the server. 
In some applications, this behavior may be unacceptable. 
There are several solutions, however. 
If the
<code>-x</code> option is included on the command line, the clock will
never be stepped and only slew corrections will be used. 
But this choice comes with a cost that
should be carefully explored before deciding to use
the
<code>-x</code> option. 
The maximum slew rate possible is limited
to 500 parts-per-million (PPM) as a consequence of the correctness
principles on which the NTP protocol and algorithm design are
based. 
As a result, the local clock can take a long time to
converge to an acceptable offset, about 2,000 s for each second the
clock is outside the acceptable range. 
During this interval the
local clock will not be consistent with any other network clock and
the system cannot be used for distributed applications that require
correctly synchronized network time.

  <p>In spite of the above precautions, sometimes when large
frequency errors are present the resulting time offsets stray
outside the 128-ms range and an eventual step or slew time
correction is required. 
If following such a correction the
frequency error is so large that the first sample is outside the
acceptable range,
<code>ntpd</code>
enters the same state as when the
<span class="file">ntp.drift</span>
file is not present. 
The intent of this behavior
is to quickly correct the frequency and restore operation to the
normal tracking mode. 
In the most extreme cases
(the host
<code>time.ien.it</code> comes to mind), there may be occasional
step/slew corrections and subsequent frequency corrections. 
It
helps in these cases to use the
<code>burst</code> keyword when
configuring the server, but
ONLY
when you have permission to do so from the owner of the target host.

  <p>Finally,
in the past many startup scripts would run
<code>ntpdate(8)</code>
to get the system clock close to correct before starting
<code>ntpd(8)</code>,
but this was never more than a mediocre hack and is no longer needed.

  <p>There is a way to start
<code>ntpd(8)</code>
that often addresses all of the problems mentioned above. 
<div class="node">
<p><hr>
<a name="Starting-NTP-_0028Best-Current-Practice_0029"></a>
<br>
</div>

<h3 class="section">Starting NTP (Best Current Practice)</h3>

<p>Starting NTP (Best Current Practice)
First, use the
<code>iburst</code> option on your
<code>server</code> entries.

  <p>If you can also keep a good
<span class="file">ntp.drift</span>
file then
<code>ntpd(8)</code>
will effectively "warm-start" and your system's clock will
be stable in under 11 seconds' time.

  <p>As soon as possible in the startup sequence, start
<code>ntpd(8)</code>
with at least the
<code>-g</code> and perhaps the
<code>-N</code> options. 
Then,
start the rest of your "normal" processes. 
This will give
<code>ntpd(8)</code>
as much time as possible to get the system's clock synchronized and stable.

  <p>Finally,
if you have processes like
<code>dovecot</code> or database servers
that require
monotonically-increasing time,
run
<code>ntp-wait(8)</code>
as late as possible in the boot sequence
(perhaps with the
<code>-v</code> flag)
and after
<code>ntp-wait(8)</code>
exits successfully
it is as safe as it will ever be to start any process that require
stable time. 
<div class="node">
<p><hr>
<a name="Frequency-Discipline"></a>
<br>
</div>

<h3 class="section">Frequency Discipline</h3>

<p>Frequency Discipline
The
<code>ntpd</code>
behavior at startup depends on whether the
frequency file, usually
<span class="file">ntp.drift</span>,
exists. 
This file
contains the latest estimate of clock frequency error. 
When the
<code>ntpd</code>
is started and the file does not exist, the
<code>ntpd</code>
enters a special mode designed to quickly adapt to
the particular system clock oscillator time and frequency error. 
This takes approximately 15 minutes, after which the time and
frequency are set to nominal values and the
<code>ntpd</code>
enters
normal mode, where the time and frequency are continuously tracked
relative to the server. 
After one hour the frequency file is
created and the current frequency offset written to it. 
When the
<code>ntpd</code>
is started and the file does exist, the
<code>ntpd</code>
frequency is initialized from the file and enters normal mode
immediately. 
After that the current frequency offset is written to
the file at hourly intervals. 
<div class="node">
<p><hr>
<a name="Operating-Modes"></a>
<br>
</div>

<h3 class="section">Operating Modes</h3>

<p>Operating Modes
The
<code>ntpd</code>
utility can operate in any of several modes, including
symmetric active/passive, client/server broadcast/multicast and
manycast, as described in the
"Association Management"
page
(available as part of the HTML documentation
provided in
<span class="file">/usr/share/doc/ntp</span>). 
It normally operates continuously while
monitoring for small changes in frequency and trimming the clock
for the ultimate precision. 
However, it can operate in a one-time
mode where the time is set from an external server and frequency is
set from a previously recorded frequency file. 
A
broadcast/multicast or manycast client can discover remote servers,
compute server-client propagation delay correction factors and
configure itself automatically. 
This makes it possible to deploy a
fleet of workstations without specifying configuration details
specific to the local environment.

  <p>By default,
<code>ntpd</code>
runs in continuous mode where each of
possibly several external servers is polled at intervals determined
by an intricate state machine. 
The state machine measures the
incidental roundtrip delay jitter and oscillator frequency wander
and determines the best poll interval using a heuristic algorithm. 
Ordinarily, and in most operating environments, the state machine
will start with 64s intervals and eventually increase in steps to
1024s. 
A small amount of random variation is introduced in order to
avoid bunching at the servers. 
In addition, should a server become
unreachable for some time, the poll interval is increased in steps
to 1024s in order to reduce network overhead.

  <p>In some cases it may not be practical for
<code>ntpd</code>
to run
continuously. 
A common workaround has been to run the
<code>ntpdate(8)</code>
program from a
<code>cron(8)</code>
job at designated
times. 
However, this program does not have the crafted signal
processing, error checking and mitigation algorithms of
<code>ntpd</code>. 
The
<code>-q</code> option is intended for this purpose. 
Setting this option will cause
<code>ntpd</code>
to exit just after
setting the clock for the first time. 
The procedure for initially
setting the clock is the same as in continuous mode; most
applications will probably want to specify the
<code>iburst</code> keyword with the
<code>server</code> configuration command. 
With this
keyword a volley of messages are exchanged to groom the data and
the clock is set in about 10 s. 
If nothing is heard after a
couple of minutes, the daemon times out and exits. 
After a suitable
period of mourning, the
<code>ntpdate(8)</code>
program may be
retired.

  <p>When kernel support is available to discipline the clock
frequency, which is the case for stock Solaris, Tru64, Linux and
.Fx
,
a useful feature is available to discipline the clock
frequency. 
First,
<code>ntpd</code>
is run in continuous mode with
selected servers in order to measure and record the intrinsic clock
frequency offset in the frequency file. 
It may take some hours for
the frequency and offset to settle down. 
Then the
<code>ntpd</code>
is
stopped and run in one-time mode as required. 
At each startup, the
frequency is read from the file and initializes the kernel
frequency. 
<div class="node">
<p><hr>
<a name="Poll-Interval-Control"></a>
<br>
</div>

<h3 class="section">Poll Interval Control</h3>

<p>Poll Interval Control
This version of NTP includes an intricate state machine to
reduce the network load while maintaining a quality of
synchronization consistent with the observed jitter and wander. 
There are a number of ways to tailor the operation in order enhance
accuracy by reducing the interval or to reduce network overhead by
increasing it. 
However, the user is advised to carefully consider
the consequences of changing the poll adjustment range from the
default minimum of 64 s to the default maximum of 1,024 s. 
The
default minimum can be changed with the
<code>tinker</code> <code>minpoll</code> command to a value not less than 16 s. 
This value is used for all
configured associations, unless overridden by the
<code>minpoll</code> option on the configuration command. 
Note that most device drivers
will not operate properly if the poll interval is less than 64 s
and that the broadcast server and manycast client associations will
also use the default, unless overridden.

  <p>In some cases involving dial up or toll services, it may be
useful to increase the minimum interval to a few tens of minutes
and maximum interval to a day or so. 
Under normal operation
conditions, once the clock discipline loop has stabilized the
interval will be increased in steps from the minimum to the
maximum. 
However, this assumes the intrinsic clock frequency error
is small enough for the discipline loop correct it. 
The capture
range of the loop is 500 PPM at an interval of 64s decreasing by a
factor of two for each doubling of interval. 
At a minimum of 1,024
s, for example, the capture range is only 31 PPM. 
If the intrinsic
error is greater than this, the drift file
<span class="file">ntp.drift</span>
will
have to be specially tailored to reduce the residual error below
this limit. 
Once this is done, the drift file is automatically
updated once per hour and is available to initialize the frequency
on subsequent daemon restarts. 
<div class="node">
<p><hr>
<a name="The-huff_002dn_0027_002dpuff-Filter"></a>
<br>
</div>

<h3 class="section">The huff-n'-puff Filter</h3>

<p>The huff-n'-puff Filter
In scenarios where a considerable amount of data are to be
downloaded or uploaded over telephone modems, timekeeping quality
can be seriously degraded. 
This occurs because the differential
delays on the two directions of transmission can be quite large. 
In
many cases the apparent time errors are so large as to exceed the
step threshold and a step correction can occur during and after the
data transfer is in progress.

  <p>The huff-n'-puff filter is designed to correct the apparent time
offset in these cases. 
It depends on knowledge of the propagation
delay when no other traffic is present. 
In common scenarios this
occurs during other than work hours. 
The filter maintains a shift
register that remembers the minimum delay over the most recent
interval measured usually in hours. 
Under conditions of severe
delay, the filter corrects the apparent offset using the sign of
the offset and the difference between the apparent delay and
minimum delay. 
The name of the filter reflects the negative (huff)
and positive (puff) correction, which depends on the sign of the
offset.

  <p>The filter is activated by the
<code>tinker</code> command and
<code>huffpuff</code> keyword, as described in
<code>ntp.conf(5)</code>. 
<div class="node">
<p><hr>
<a name="ntpd-Files"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-See-Also">ntpd See Also</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-Usage">ntpd Usage</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ntpd Files</h4>

     <dl>
<dt><span class="samp">Pa</span><dd>the default name of the configuration file
<br><dt><span class="samp">Pa</span><dd>the default name of the drift file
<br><dt><span class="samp">Pa</span><dd>the default name of the key file

<div class="node">
<p><hr>
<a name="ntpd-See-Also"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-Bugs">ntpd Bugs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-Files">ntpd Files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ntpd See Also</h4>

     <p><code>ntp.conf(5)</code>,
<code>ntpdate(8)</code>,
<code>ntpdc(8)</code>,
<code>ntpq(8)</code>

       <p>In addition to the manual pages provided,
comprehensive documentation is available on the world wide web
at
.Li
http://www.ntp.org/
. 
A snapshot of this documentation is available in HTML format in
<span class="file">/usr/share/doc/ntp</span>. 
.Rs
.%A
David
L. 
Mills
.%T
Network
Time
Protocol
(Version
1)
.%O
RFC1059
.Re
.Rs
.%A
David
L. 
Mills
.%T
Network
Time
Protocol
(Version
2)
.%O
RFC1119
.Re
.Rs
.%A
David
L. 
Mills
.%T
Network
Time
Protocol
(Version
3)
.%O
RFC1305
.Re
.Rs
.%A
David
L. 
Mills
.%A
J. 
Martin,
Ed. 
.%A
J. 
Burbank
.%A
W. 
Kasch
.%T
Network
Time
Protocol
Version
4:
Protocol
and
Algorithms
Specification
.%O
RFC5905
.Re
.Rs
.%A
David
L. 
Mills
.%A
B. 
Haberman,
Ed. 
.%T
Network
Time
Protocol
Version
4:
Autokey
Specification
.%O
RFC5906
.Re
.Rs
.%A
H. 
Gerstung
.%A
C. 
Elliott
.%A
B. 
Haberman,
Ed. 
.%T
Definitions
of
Managed
Objects
for
Network
Time
Protocol
Version
4:
(NTPv4)
.%O
RFC5907
.Re
.Rs
.%A
R. 
Gayraud
.%A
B. 
Lourdelet
.%T
Network
Time
Protocol
(NTP)
Server
Option
for
DHCPv6
.%O
RFC5908
.Re
<div class="node">
<p><hr>
<a name="ntpd-Bugs"></a>Next:&nbsp;<a rel="next" accesskey="n" href="#ntpd-Notes">ntpd Notes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-See-Also">ntpd See Also</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ntpd Bugs</h4>

     <p>The
<code>ntpd</code>
utility has gotten rather fat. 
While not huge, it has gotten
larger than might be desirable for an elevated-priority
<code>ntpd</code>
running on a workstation, particularly since many of
the fancy features which consume the space were designed more with
a busy primary server, rather than a high stratum workstation in
mind. 
<div class="node">
<p><hr>
<a name="ntpd-Notes"></a>Previous:&nbsp;<a rel="previous" accesskey="p" href="#ntpd-Bugs">ntpd Bugs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ntpd-Invocation">ntpd Invocation</a>
<br>
</div>

<h4 class="subsection">ntpd Notes</h4>

     <p>This document corresponds to version  of NTP. 
Portions of this document came from FreeBSD.

<div class="node">
<p><hr>
<a name="Usage"></a>
<br>
</div>

     <!-- node-name,  next,  previous,  up -->
<h3 class="section">Usage</h3>

